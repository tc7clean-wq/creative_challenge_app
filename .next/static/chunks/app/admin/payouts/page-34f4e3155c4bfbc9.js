(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7802],{4434:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(5155),l=s(2115),i=s(9523),n=s(521);function r(){let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[o,h]=(0,l.useState)([]),[u,x]=(0,l.useState)(!1),[m,p]=(0,l.useState)("all"),[b,g]=(0,l.useState)(null),[y,f]=(0,l.useState)({canCreateContests:!1,canManagePayouts:!1,canManagePlatform:!1}),[j,_]=(0,l.useState)(null),N=(0,l.useCallback)(async()=>{if(j)try{let{data:e,error:s}=await j.from("contest_payouts").select("\n          *,\n          contests(title),\n          profiles(email),\n          artist_accounts(chime_username, paypal_email, stripe_account_id)\n        ").order("created_at",{ascending:!1});if(s)throw s;let a=(null==e?void 0:e.map(e=>{var t,s,a,l,i;return{...e,contest_title:null==(t=e.contests)?void 0:t.title,user_email:null==(s=e.profiles)?void 0:s.email,chime_username:null==(a=e.artist_accounts)?void 0:a.chime_username,paypal_email:null==(l=e.artist_accounts)?void 0:l.paypal_email,stripe_account_id:null==(i=e.artist_accounts)?void 0:i.stripe_account_id}}))||[];t(a)}catch(e){console.error("Error fetching payouts:",e)}},[j]),w=(0,l.useCallback)(async()=>{if(j)try{let{data:e,error:t}=await j.from("payout_batches").select("*").order("created_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){console.error("Error fetching batches:",e)}},[j]);(0,l.useEffect)(()=>{_((0,i.U)())},[]),(0,l.useEffect)(()=>{j&&(async()=>{let{data:{user:e}}=await j.auth.getUser();if(g(e),e){let{data:t}=await j.from("profiles").select("is_admin").eq("id",e.id).single(),s=(null==t?void 0:t.is_admin)||e.email&&e.email.endsWith("@creativechallenge.app");f({canCreateContests:!0,canManagePayouts:s,canManagePlatform:(null==t?void 0:t.is_admin)||e.email&&e.email.endsWith("@creativechallenge.app")}),s&&(await N(),await w())}d(!1)})()},[j,N,w]);let v=async(e,t,s)=>{if(j)try{let{error:a}=await j.from("contest_payouts").update({payout_status:t,payout_date:"paid"===t?new Date().toISOString():null,failure_reason:s||null}).eq("id",e);if(a)throw a;N()}catch(e){console.error("Error updating payout status:",e)}},k=async()=>{if(0!==o.length&&j){x(!0);try{var t;let s=e.filter(e=>o.includes(e.id)),a=s.reduce((e,t)=>e+t.net_amount,0),{error:l}=await j.from("payout_batches").insert([{contest_id:null==(t=s[0])?void 0:t.contest_id,batch_name:"Batch ".concat(new Date().toISOString().split("T")[0]),total_amount:a,total_payouts:o.length,status:"pending",created_by:null==b?void 0:b.id}]).select().single();if(l)throw l;let{error:i}=await j.from("contest_payouts").update({payout_status:"processing"}).in("id",o);if(i)throw i;h([]),N(),w()}catch(e){console.error("Error creating batch:",e)}finally{x(!1)}}},C=e.filter(e=>"all"===m||e.payout_status===m);return c?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-white"})}):y.canManagePayouts?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[(0,a.jsx)(n.A,{}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white mb-4",children:"\uD83D\uDCB0 Payout Management"}),(0,a.jsx)("p",{className:"text-white/70",children:"Manage contest payouts and track payment status"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:["$",e.filter(e=>"pending"===e.payout_status).reduce((e,t)=>e+t.net_amount,0).toLocaleString()]}),(0,a.jsx)("div",{className:"text-white/60 text-sm",children:"Pending Payouts"})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-blue-400 mb-1",children:["$",e.filter(e=>"paid"===e.payout_status).reduce((e,t)=>e+t.net_amount,0).toLocaleString()]}),(0,a.jsx)("div",{className:"text-white/60 text-sm",children:"Paid Out"})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-400 mb-1",children:e.filter(e=>"pending"===e.payout_status).length}),(0,a.jsx)("div",{className:"text-white/60 text-sm",children:"Pending Count"})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-400 mb-1",children:s.length}),(0,a.jsx)("div",{className:"text-white/60 text-sm",children:"Total Batches"})]})]}),(0,a.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,a.jsx)("div",{className:"flex gap-2",children:["all","pending","processing","paid","failed"].map(e=>(0,a.jsx)("button",{onClick:()=>p(e),className:"px-4 py-2 rounded-lg font-medium transition-all ".concat(m===e?"bg-white/20 text-white":"bg-white/5 text-white/70 hover:bg-white/10"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),o.length>0&&(0,a.jsx)("button",{onClick:k,disabled:u,className:"bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:from-green-600 hover:to-blue-700 transition-all duration-300 disabled:opacity-50",children:u?"Creating...":"Create Batch (".concat(o.length,")")})]})}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Contest Payouts"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-white",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-white/20",children:[(0,a.jsx)("th",{className:"text-left py-3",children:(0,a.jsx)("input",{type:"checkbox",onChange:e=>{e.target.checked?h(C.filter(e=>"pending"===e.payout_status).map(e=>e.id)):h([])},className:"rounded"})}),(0,a.jsx)("th",{className:"text-left py-3",children:"Contest"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Winner"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Position"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Amount"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Method"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-3",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:C.map(e=>(0,a.jsxs)("tr",{className:"border-b border-white/10",children:[(0,a.jsx)("td",{className:"py-3",children:"pending"===e.payout_status&&(0,a.jsx)("input",{type:"checkbox",checked:o.includes(e.id),onChange:t=>{t.target.checked?h([...o,e.id]):h(o.filter(t=>t!==e.id))},className:"rounded"})}),(0,a.jsx)("td",{className:"py-3",children:e.contest_title}),(0,a.jsx)("td",{className:"py-3",children:e.user_email}),(0,a.jsxs)("td",{className:"py-3",children:[(0,a.jsx)("span",{className:"text-lg",children:1===e.position?"\uD83E\uDD47":2===e.position?"\uD83E\uDD48":"\uD83E\uDD49"}),e.position]}),(0,a.jsxs)("td",{className:"py-3 font-bold text-green-400",children:["$",e.net_amount.toLocaleString()]}),(0,a.jsxs)("td",{className:"py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"chime"===e.payout_method?"\uD83C\uDFE6":"paypal"===e.payout_method?"\uD83D\uDC99":"\uD83D\uDCB3"}),(0,a.jsx)("span",{className:"capitalize",children:e.payout_method})]}),(0,a.jsxs)("div",{className:"text-xs text-white/60",children:["chime"===e.payout_method&&e.chime_username&&"@".concat(e.chime_username),"paypal"===e.payout_method&&e.paypal_email,"stripe"===e.payout_method&&e.stripe_account_id]})]}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("pending"===e.payout_status?"bg-yellow-500/20 text-yellow-300":"processing"===e.payout_status?"bg-blue-500/20 text-blue-300":"paid"===e.payout_status?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:e.payout_status})}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsxs)("div",{className:"flex gap-2",children:["pending"===e.payout_status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>v(e.id,"processing"),className:"text-blue-400 hover:text-blue-300 text-sm",children:"Process"}),(0,a.jsx)("button",{onClick:()=>v(e.id,"paid"),className:"text-green-400 hover:text-green-300 text-sm",children:"Mark Paid"})]}),"processing"===e.payout_status&&(0,a.jsx)("button",{onClick:()=>v(e.id,"paid"),className:"text-green-400 hover:text-green-300 text-sm",children:"Mark Paid"}),"failed"===e.payout_status&&(0,a.jsx)("button",{onClick:()=>v(e.id,"pending"),className:"text-yellow-400 hover:text-yellow-300 text-sm",children:"Retry"})]})})]},e.id))})]})})]}),s.length>0&&(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20 mt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Recent Payout Batches"}),(0,a.jsx)("div",{className:"space-y-4",children:s.slice(0,5).map(e=>(0,a.jsx)("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:e.batch_name}),(0,a.jsxs)("p",{className:"text-white/60 text-sm",children:[e.total_payouts," payouts â€¢ $",e.total_amount.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("pending"===e.status?"bg-yellow-500/20 text-yellow-300":"processing"===e.status?"bg-blue-500/20 text-blue-300":"completed"===e.status?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:e.status}),(0,a.jsx)("div",{className:"text-white/60 text-xs mt-1",children:new Date(e.created_at).toLocaleDateString()})]})]})},e.id))})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-white/70",children:"You need admin privileges to access this page."})]})})}},4613:(e,t,s)=>{Promise.resolve().then(s.bind(s,4434))}},e=>{e.O(0,[7559,2619,5239,521,8441,1255,7358],()=>e(e.s=4613)),_N_E=e.O()}]);